var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{h(r.next(t))}catch(e){s(e)}}function a(t){try{h(r["throw"](t))}catch(e){s(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,a)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,s&&(o=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],s=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},AcmojiNetwork=function(){function t(){}return t.init=function(t){this._local_id=t},t.dataOperation=function(){var t={action:"data-operation"},e={entity_name:this._entity_name};return{header:t,body:e}},t.save=function(t,e,i){var r=this.dataOperation();t.uid=this._local_id,r.body.operation_type="save",r.body.entity_value=t,this.request(r,e,i)},t.update=function(t,e,i){var r=this.dataOperation();t.uid=this._local_id,r.body.operation_type="update",r.body.entity_value=t,this.request(r,e,i)},t["delete"]=function(t,e){var i=this.dataOperation(),r={};r.uid=this._local_id,i.body.operation_type="delete",i.body.entity_value=r,this.request(i,t,e)},t.query=function(t,e,i){var r=this.dataOperation(),n={};n.uid=this._local_id,r.body.operation_type=t?"query_consistent":"consistent",r.body.entity_value=n,this.request(r,e,i)},t.request=function(t,e,i){var r=window.tm;r.Request({type:t.body.operation_type,name:t.body.entity_name,data:t.body.entity_value,success:function(t){e(t)},fail:function(){var t=new AcmojiNetworkError(0);console.log("Error: "+t.toString()),i(t)}})},t._entity_name="intmoji",t}();__reflect(AcmojiNetwork.prototype,"AcmojiNetwork");var AcmojiNetworkError=function(){function t(e){this.code=e,this.description=t.AcmojiNetworkErrorParser[e.toString()],this.description||(this.description="未知错误")}return t.prototype.toString=function(){return"errorCode:"+this.code+" errorDes:"+this.description},t.AcmojiNetworkErrorParser={0:"网络错误","-1":"解析失败","-2":"action参数不支持","-3":"参数不满足","-103":"内部错误","-201":"Uid不正确","-202":"无此操作权限","-203":"auth_key无效","-204":"app_key无效"},t}();__reflect(AcmojiNetworkError.prototype,"AcmojiNetworkError");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.hisInfo={name:""},e.myInfo={name:""},e.otherNumber=-1,document.addEventListener("deviceready",e.deviceready.bind(e)),e}return __extends(e,t),e.prototype.deviceready=function(){var t=this,e=window.tm;e&&e.GetMessageInfo({keys:["direct","sessionId"],success:function(i){t.isSender="out"===i.direct,t.isWaiting=t.isSender,e.GetUserInfo({id:i.sessionId,keys:["name"],success:function(i){t.isSender?t.hisInfo.name=i.name:t.myInfo.name=i.name,e.GetMyInfo({keys:["name"],success:function(e){t.isSender?t.myInfo.name=e.name:t.hisInfo.name=e.name,t.isDeviceReady=!0,console.log("isDeviceReady--"+new Date),t.startGame()}})}})},fail:function(){}})},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.isStageReady=!0,console.log("isStageReady--"+new Date),this.startGame()},e.prototype.startGame=function(){this.isReady()&&(console.log("isReady--"+new Date),this.runGame()["catch"](function(t){console.log(t)}))},e.prototype.isReady=function(){return this.isDeviceReady&&this.isStageReady},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.createBg(246,278,this.isSender),this.createTitle(246,this.myInfo.name,this.hisInfo.name),this.createGameView(),this.createRPSView(),this.initGame(this.isSender),this.bindEvent()},e.prototype.createBg=function(t,e,i){this.bg=new View,this.bg.setFrame(0,0,246,278),this.addChild(this.bg),this.bg.layoutSubviews(),this.bg.touchEnabled=!1,this.bg.setColor(i?16498697:6658047)},e.prototype.createTitle=function(t,e,i){var r=32,n=new egret.Sprite;n.graphics.beginFill(2520758,1),n.graphics.drawRect(0,0,t,r),n.graphics.endFill(),n.x=0,n.y=0,this.addChild(n);var s=r,o=t,a=o/2,h=s,c=a-h,d=new egret.TextField;d.background=!0,d.backgroundColor=2520758,d.$setBorder,d.size=13,d.width=c,d.height=s,d.textColor=16777215,d.text=e,d.textAlign=egret.HorizontalAlign.CENTER,d.verticalAlign=egret.VerticalAlign.MIDDLE,d.x=0,d.y=0,n.addChild(d);var u=new egret.TextField;u.background=!0,u.backgroundColor=16777215,u.size=13,u.border=!0,u.borderColor=2520758,u.width=h,u.height=h,u.textColor=0,u.text="0",u.textAlign=egret.HorizontalAlign.CENTER,u.verticalAlign=egret.VerticalAlign.MIDDLE,u.x=c,u.y=0,n.addChild(u);var l=new egret.TextField;l.background=!0,l.backgroundColor=16504763,l.size=13,l.border=!0,l.borderColor=15963208,l.width=c,l.height=s,l.textColor=0,l.text=i,l.textAlign=egret.HorizontalAlign.CENTER,l.verticalAlign=egret.VerticalAlign.MIDDLE,l.x=a,l.y=0,n.addChild(l);var p=new egret.TextField;p.background=!0,p.backgroundColor=16777215,p.size=13,p.border=!0,p.borderColor=15963208,p.width=h,p.height=h,p.textColor=0,p.text="0",p.textAlign=egret.HorizontalAlign.CENTER,p.verticalAlign=egret.VerticalAlign.MIDDLE,p.x=a+c,p.y=0,n.addChild(p),this.title={myNameTxt:d,myScoreTxt:u,hisNameTxt:l,hisScoreTxt:p}},e.prototype.createGameView=function(){var t=this.createBitmapByName("scissors_words_png");t.x=105,t.y=74,t.width=45,t.height=23,this.addChild(t);var e=this.createBitmapByName("rock_words_png");e.x=50,e.y=160,e.width=35,e.height=45,this.addChild(e);var i=this.createBitmapByName("paper_words_png");i.x=170,i.y=160,i.width=35,i.height=40,this.addChild(i);var r=this.createBitmapByName("arrow_png");r.x=35,r.y=60,r.width=181,r.height=165,this.addChild(r);var n=this.createBitmapByName("scissors_png");n.x=78,n.y=113,n.width=36,n.height=36,this.addChild(n);var s=this.createBitmapByName("rock_png");s.x=104,s.y=165,s.width=36,s.height=36,this.addChild(s);var o=this.createBitmapByName("paper_png");o.x=134,o.y=113,o.width=36,o.height=36,this.addChild(o)},e.prototype.initGame=function(t){this.bg.setColor(t?16498697:6658047),this.rock_hand_btn.touchEnabled=this.isWaiting?!1:!0,this.paper_hand_btn.touchEnabled=this.isWaiting?!1:!0,this.scissors_hand_btn.touchEnabled=this.isWaiting?!1:!0},e.prototype.createRPSView=function(){this.paper_hand_btn=new eui.ToggleButton,this.paper_hand_btn.x=168,this.paper_hand_btn.y=80,this.paper_hand_btn.width=62,this.paper_hand_btn.height=62,this.addChild(this.paper_hand_btn),this.paper_hand_btn.addEventListener(egret.TouchEvent.CHANGE,this.casePaper,this),this.paper_hand_btn.skinName="resource/eui_skins/PaperButton.exml",this.rock_hand_btn=new eui.ToggleButton,this.rock_hand_btn.x=92,this.rock_hand_btn.y=202,this.rock_hand_btn.width=62,this.rock_hand_btn.height=62,this.addChild(this.rock_hand_btn),this.rock_hand_btn.addEventListener(egret.TouchEvent.CHANGE,this.caseRock,this),this.rock_hand_btn.skinName="resource/eui_skins/RockButton.exml",this.scissors_hand_btn=new eui.ToggleButton,this.scissors_hand_btn.x=18,this.scissors_hand_btn.y=80,this.scissors_hand_btn.width=62,this.scissors_hand_btn.height=62,this.addChild(this.scissors_hand_btn),this.scissors_hand_btn.addEventListener(egret.TouchEvent.CHANGE,this.caseScissors,this),this.scissors_hand_btn.skinName="resource/eui_skins/ScissorsButton.exml"},e.prototype.restartGame=function(){this.myNumber=-1,this.otherNumber=-1,this.removeChild(this.scissors_hand_btn),this.removeChild(this.paper_hand_btn),this.removeChild(this.rock_hand_btn),this.createRPSView(),this.initGame(this.isSender)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.caseRock=function(){if(!this.isSender){this.scissors_hand_btn.touchEnabled=!1,this.paper_hand_btn.touchEnabled=!1,this.rock_hand_btn.touchEnabled=!1;var t=1;return this.myNumber=t,this.bg.setColor(16498697),void this.sendNotification(t)}if(-1!=this.otherNumber){this.scissors_hand_btn.touchEnabled=!1,this.paper_hand_btn.touchEnabled=!1,this.rock_hand_btn.touchEnabled=!1;var t=1;this.myNumber=t,this.bg.setColor(6658047),console.log("选择之后mynumber"+this.myNumber+"playerNumber"+this.otherNumber);var e=this.checWin(this.myNumber,this.otherNumber);0==e?(alert("is tie!"),this.sendResult(0)):-1==e?(this.increaseMyScore(),this.sendResult(1),alert("you win")):1==e&&(this.increaseHisScore(),this.sendResult(-1),alert("he win")),this.restartGame()}},e.prototype.caseScissors=function(){if(!this.isSender){this.scissors_hand_btn.touchEnabled=!1,this.paper_hand_btn.touchEnabled=!1,this.rock_hand_btn.touchEnabled=!1;var t=2;return this.myNumber=t,this.bg.setColor(16498697),void this.sendNotification(t)}if(-1!=this.otherNumber){this.scissors_hand_btn.touchEnabled=!1,this.paper_hand_btn.touchEnabled=!1,this.rock_hand_btn.touchEnabled=!1;var t=2;this.myNumber=t,this.bg.setColor(6658047),console.log("选择之后mynumber"+this.myNumber+"playerNumber"+this.otherNumber);var e=this.checWin(this.myNumber,this.otherNumber);0==e?(alert("is tie!"),this.sendResult(0)):-1==e?(this.increaseMyScore(),this.sendResult(1),alert("you win")):1==e&&(this.increaseHisScore(),this.sendResult(-1),alert("he win")),this.restartGame()}},e.prototype.casePaper=function(){if(!this.isSender){this.scissors_hand_btn.touchEnabled=!1,this.paper_hand_btn.touchEnabled=!1,this.rock_hand_btn.touchEnabled=!1;var t=3;return this.myNumber=t,this.bg.setColor(16498697),void this.sendNotification(t)}if(-1!=this.otherNumber){this.scissors_hand_btn.touchEnabled=!1,this.paper_hand_btn.touchEnabled=!1,this.rock_hand_btn.touchEnabled=!1;var t=3;this.myNumber=t,this.bg.setColor(6658047),console.log("选择之后mynumber"+this.myNumber+"playerNumber"+this.otherNumber);var e=this.checWin(this.myNumber,this.otherNumber);0==e?(alert("is tie!"),this.sendResult(0)):-1==e?(this.increaseMyScore(),this.sendResult(1),alert("you win")):1==e&&(this.increaseHisScore(),this.sendResult(-1),alert("he win")),this.restartGame()}},e.prototype.bindEvent=function(){window.addEventListener("notificationreceiver",this.onIntmojiStateChanged.bind(this),!1)},e.prototype.onIntmojiStateChanged=function(t){var e=t.intmoji;if("rps"==e.command){if(!this.isSender)return;this.scissors_hand_btn.touchEnabled=!0,this.paper_hand_btn.touchEnabled=!0,this.rock_hand_btn.touchEnabled=!0,this.bg.setColor(6658047);var i=e.rpsResult;console.log("mynumber"+this.myNumber+"playerNumber"+i),console.log("onIntmojiStateChanged  ok"),this.otherNumber=i}if("score"==e.command){if(this.isSender)return;var r=e.result;-1==r?(alert("you win"),this.increaseHisScore()):0==r?alert("is tie"):(alert("he win"),this.increaseMyScore()),this.restartGame()}},e.prototype.sendNotification=function(t){setTimeout(function(){var e=window.tm;e&&e.SendNotification({type:"custom",data:{rpsResult:t,command:"rps"}})},0)},e.prototype.sendResult=function(t){setTimeout(function(){var e=window.tm;e&&e.SendNotification({type:"custom",data:{result:t,command:"score"}})},0)},e.prototype.increaseMyScore=function(){this.title.myScoreTxt.text=parseInt(this.title.myScoreTxt.text)+1+""},e.prototype.increaseHisScore=function(){this.title.hisScoreTxt.text=parseInt(this.title.hisScoreTxt.text)+1+""},e.prototype.checWin=function(t,e){return 1==this.myNumber&&1==e||2==this.myNumber&&2==e||3==this.myNumber&&3==e?0:1==this.myNumber&&2==e||2==this.myNumber&&3==e||3==this.myNumber&&1==e?-1:1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function n(t){e.call(r,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(r))}var o=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(r,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var View=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.layoutSubviews=function(){this.color&&this.setColor(this.color)},e.prototype.setColor=function(t){this.graphics.beginFill(t),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this.color=t},e.prototype.setFrame=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},e}(egret.Sprite);__reflect(View.prototype,"View");