var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{c(n.next(t))}catch(e){o(e)}}function a(t){try{c(n["throw"](t))}catch(e){o(e)}}function c(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}c((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){c.label=i[1];break}if(6===i[0]&&c.label<s[1]){c.label=s[1],s=i;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(i);break}s[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},AcmojiNetwork=function(){function t(){}return t.init=function(t){this._local_id=t},t.dataOperation=function(){var t={action:"data-operation"},e={entity_name:this._entity_name};return{header:t,body:e}},t.save=function(t,e,i){var n=this.dataOperation();t.uid=this._local_id,n.body.operation_type="save",n.body.entity_value=t,this.request(n,e,i)},t.update=function(t,e,i){var n=this.dataOperation();t.uid=this._local_id,n.body.operation_type="update",n.body.entity_value=t,this.request(n,e,i)},t["delete"]=function(t,e){var i=this.dataOperation(),n={};n.uid=this._local_id,i.body.operation_type="delete",i.body.entity_value=n,this.request(i,t,e)},t.query=function(t,e,i){var n=this.dataOperation(),r={};r.uid=this._local_id,n.body.operation_type=t?"query_consistent":"consistent",n.body.entity_value=r,this.request(n,e,i)},t.request=function(t,e,i){var n=window.tm;n.Request({type:t.body.operation_type,name:t.body.entity_name,data:t.body.entity_value,success:function(t){e(t)},fail:function(){var t=new AcmojiNetworkError(0);console.log("Error: "+t.toString()),i(t)}})},t._entity_name="intmoji",t}();__reflect(AcmojiNetwork.prototype,"AcmojiNetwork");var AcmojiNetworkError=function(){function t(e){this.code=e,this.description=t.AcmojiNetworkErrorParser[e.toString()],this.description||(this.description="未知错误")}return t.prototype.toString=function(){return"errorCode:"+this.code+" errorDes:"+this.description},t.AcmojiNetworkErrorParser={0:"网络错误","-1":"解析失败","-2":"action参数不支持","-3":"参数不满足","-103":"内部错误","-201":"Uid不正确","-202":"无此操作权限","-203":"auth_key无效","-204":"app_key无效"},t}();__reflect(AcmojiNetworkError.prototype,"AcmojiNetworkError");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.hisInfo={name:""},e.myInfo={name:""},document.addEventListener("deviceready",e.deviceready.bind(e)),e}return __extends(e,t),e.prototype.initdata=function(){var t=this;AcmojiNetwork.query(!0,function(e){t.data=e,"undefined"==typeof e.rs&&(t.data.rs=0),"undefined"==typeof e.a&&(t.data.a=0),"undefined"==typeof e.b&&(t.data.b=0),t.isDeviceReady=!0,t.startGame()},function(t){console.log("query error")})},e.prototype.deviceready=function(){var t=this,e=window.tm;e&&e.GetMessageInfo({keys:["direct","sessionId","messageId"],success:function(i){t.isSender="out"===i.direct,t.isWaiting=t.isSender,AcmojiNetwork.init(i.messageId),e.GetUserInfo({id:i.sessionId,keys:["name"],success:function(i){t.isSender?t.hisInfo.name=i.name:t.myInfo.name=i.name,e.GetMyInfo({keys:["name"],success:function(e){t.isSender?t.myInfo.name=e.name:t.hisInfo.name=e.name,console.log("isDeviceReady--"+new Date),t.initdata()}})}})},fail:function(){}})},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.isStageReady=!0,console.log("isStageReady--"+new Date),this.startGame()},e.prototype.startGame=function(){this.isReady()&&(console.log("isReady--"+new Date),this.runGame()["catch"](function(t){console.log(t)}))},e.prototype.isReady=function(){return this.isDeviceReady&&this.isStageReady},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.createBg(246,278,this.isSender),this.createTitle(246,this.myInfo.name,this.hisInfo.name),this.createGameView(),this.createRPSView(),this.initGame(),this.bindEvent()},e.prototype.createBg=function(t,e,i){this.bg=new View,this.bg.setFrame(0,0,246,278),this.addChild(this.bg),this.bg.layoutSubviews(),this.bg.touchEnabled=!1,this.bg.setColor(i?16498697:6658047)},e.prototype.createTitle=function(t,e,i){var n=32,r=new egret.Sprite;r.graphics.beginFill(2520758,1),r.graphics.drawRect(0,0,t,n),r.graphics.endFill(),r.x=0,r.y=0,this.addChild(r);var o=n,s=t,a=s/2,c=o,d=a-c,h=new egret.TextField;h.background=!0,h.backgroundColor=2520758,h.$setBorder,h.size=13,h.width=d,h.height=o,h.textColor=16777215,h.text=e,h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.x=0,h.y=0,r.addChild(h);var u=new egret.TextField;u.background=!0,u.backgroundColor=16777215,u.size=13,u.border=!0,u.borderColor=2520758,u.width=c,u.height=c,u.textColor=0,u.text="0",u.textAlign=egret.HorizontalAlign.CENTER,u.verticalAlign=egret.VerticalAlign.MIDDLE,u.x=d,u.y=0,r.addChild(u);var l=new egret.TextField;l.background=!0,l.backgroundColor=16504763,l.size=13,l.border=!0,l.borderColor=15963208,l.width=d,l.height=o,l.textColor=0,l.text=i,l.textAlign=egret.HorizontalAlign.CENTER,l.verticalAlign=egret.VerticalAlign.MIDDLE,l.x=a,l.y=0,r.addChild(l);var p=new egret.TextField;p.background=!0,p.backgroundColor=16777215,p.size=13,p.border=!0,p.borderColor=15963208,p.width=c,p.height=c,p.textColor=0,p.text="0",p.textAlign=egret.HorizontalAlign.CENTER,p.verticalAlign=egret.VerticalAlign.MIDDLE,p.x=a+d,p.y=0,r.addChild(p),this.title={myNameTxt:h,myScoreTxt:u,hisNameTxt:l,hisScoreTxt:p}},e.prototype.createGameView=function(){var t=this.createBitmapByName("scissors_words_png");t.x=105,t.y=74,t.width=45,t.height=23,this.addChild(t);var e=this.createBitmapByName("rock_words_png");e.x=50,e.y=160,e.width=35,e.height=45,this.addChild(e);var i=this.createBitmapByName("paper_words_png");i.x=170,i.y=160,i.width=35,i.height=40,this.addChild(i);var n=this.createBitmapByName("arrow_png");n.x=35,n.y=60,n.width=181,n.height=165,this.addChild(n);var r=this.createBitmapByName("scissors_png");r.x=78,r.y=113,r.width=36,r.height=36,this.addChild(r);var o=this.createBitmapByName("rock_png");o.x=104,o.y=165,o.width=36,o.height=36,this.addChild(o);var s=this.createBitmapByName("paper_png");s.x=134,s.y=113,s.width=36,s.height=36,this.addChild(s)},e.prototype.initGame=function(){this.title.myScoreTxt.text=this.data.a.toString(),this.title.hisScoreTxt.text=this.data.b.toString(),this.isSender?0==this.data.rs?(this.bg.setColor(16498697),this.rock_hand_btn.selected=!1,this.scissors_hand_btn.selected=!1,this.paper_hand_btn.selected=!1,this.buttonEnabled(!1)):(this.bg.setColor(6658047),this.rock_hand_btn.selected=!1,this.scissors_hand_btn.selected=!1,this.paper_hand_btn.selected=!1,this.buttonEnabled(!0)):0==this.data.rs?(this.bg.setColor(6658047),this.rock_hand_btn.selected=!1,this.scissors_hand_btn.selected=!1,this.paper_hand_btn.selected=!1,this.buttonEnabled(!0)):(1==this.data.rs?this.rock_hand_btn.selected=!0:2==this.data.rs?this.scissors_hand_btn.selected=!0:3==this.data.rs&&(this.paper_hand_btn.selected=!0),this.bg.setColor(16498697),this.buttonEnabled(!1))},e.prototype.createRPSView=function(){this.paper_hand_btn=new eui.ToggleButton,this.paper_hand_btn.x=168,this.paper_hand_btn.y=80,this.paper_hand_btn.width=62,this.paper_hand_btn.height=62,this.addChild(this.paper_hand_btn),this.paper_hand_btn.addEventListener(egret.TouchEvent.CHANGE,this.casePaper,this),this.paper_hand_btn.skinName="resource/eui_skins/PaperButton.exml",this.rock_hand_btn=new eui.ToggleButton,this.rock_hand_btn.x=92,this.rock_hand_btn.y=202,this.rock_hand_btn.width=62,this.rock_hand_btn.height=62,this.addChild(this.rock_hand_btn),this.rock_hand_btn.addEventListener(egret.TouchEvent.CHANGE,this.caseRock,this),this.rock_hand_btn.skinName="resource/eui_skins/RockButton.exml",this.scissors_hand_btn=new eui.ToggleButton,this.scissors_hand_btn.x=18,this.scissors_hand_btn.y=80,this.scissors_hand_btn.width=62,this.scissors_hand_btn.height=62,this.addChild(this.scissors_hand_btn),this.scissors_hand_btn.addEventListener(egret.TouchEvent.CHANGE,this.caseScissors,this),this.scissors_hand_btn.skinName="resource/eui_skins/ScissorsButton.exml"},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.buttonEnabled=function(t){this.scissors_hand_btn.touchEnabled=t,this.paper_hand_btn.touchEnabled=t,this.rock_hand_btn.touchEnabled=t},e.prototype.tapRps=function(t){var e=this;if(!this.isSender){this.bg.setColor(16498697),this.buttonEnabled(!1);var i={rs:t};return void AcmojiNetwork.update(i,function(t){e.sendNotification(),e.data={},"undefined"==typeof t.rs&&(e.data.rs=0),"undefined"==typeof t.a&&(e.data.a=0),"undefined"==typeof t.a&&(e.data.b=0),e.initGame()},function(t){e.buttonEnabled(!0)})}this.buttonEnabled(!1);var n=this.checWin(t,this.data.rs),r=this.data;r.rs=0,0==n||(-1==n?r.a+=1:1==n&&(r.b+=1)),AcmojiNetwork.update(r,function(t){e.data=t,e.initGame(),e.sendNotification()},function(t){e.initGame()})},e.prototype.caseRock=function(){this.tapRps(1)},e.prototype.caseScissors=function(){this.tapRps(2)},e.prototype.casePaper=function(){this.tapRps(3)},e.prototype.bindEvent=function(){window.addEventListener("notificationreceiver",this.onIntmojiStateChanged.bind(this),!1)},e.prototype.onIntmojiStateChanged=function(t){var e=this,i=t.intmoji;"update"==i.command&&AcmojiNetwork.query(!0,function(t){e.data=t,"undefined"==typeof t.rs&&(e.data.rs=0),"undefined"==typeof t.a&&(e.data.a=0),"undefined"==typeof t.b&&(e.data.b=0),e.initGame()},function(t){console.log("query error")})},e.prototype.sendNotification=function(){setTimeout(function(){var t=window.tm;t&&t.SendNotification({type:"custom",data:{command:"update"}})},0)},e.prototype.increaseMyScore=function(){this.title.myScoreTxt.text=parseInt(this.title.myScoreTxt.text)+1+""},e.prototype.increaseHisScore=function(){this.title.hisScoreTxt.text=parseInt(this.title.hisScoreTxt.text)+1+""},e.prototype.checWin=function(t,e){return 1==t&&1==e||2==t&&2==e||3==t&&3==e?0:1==t&&2==e||2==t&&3==e||3==t&&1==e?-1:1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}var s=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var View=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.layoutSubviews=function(){this.color&&this.setColor(this.color)},e.prototype.setColor=function(t){this.graphics.beginFill(t),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill(),this.color=t},e.prototype.setFrame=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},e}(egret.Sprite);__reflect(View.prototype,"View");